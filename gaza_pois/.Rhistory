knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(biscale)
library(dplyr)
library(ggplot2)
library(cowplot)
#library(basemapR)
library(basemaps)
#library(ggspatial)
#library(ggmap)
Lebanon_pop_conflict <- read_sf("data_2024/pop_acled_lebanon.shp")
Lebanon_pop_conflict <- read_sf("../data_2024/pop_acled_lebanon.shp")
# draw extent
ext <- draw_ext()
ext <- draw_ext()
install.packages("mapedit")
ext <- draw_ext()
ext <- draw_ext()
View(ext)
View(Lebanon_pop_conflict)
data <- bi_class(gaza_hex_bis, x = population, y = event_id_count, style = "quantile", dim = 3)
data <- bi_class(Lebanon_pop_conflict, x = population, y = event_id_count, style = "quantile", dim = 3)
colnames(Lebanon_pop_conflict)
data <- bi_class(Lebanon_pop_conflict, x = population, y = event_id_c, style = "quantile", dim = 3)
View(data)
st_crs(data)
gaza_hex_bis <- st_transform(data, 3857)
st_crs(data)
ext <- draw_ext()
ext
set_defaults(map_service = "carto", map_type = "light_no_labels")
#as ggplot2:
basemap_ggplot(ext)
ggplot() +
basemap_gglayer(ext) +
scale_fill_identity() +
coord_sf()
# create classes
#data <- bi_class(gaza_hex, x = av_destruc, y = n_pois_category, style = "quantile", dim = 3)
data <- bi_class(Lebanon_pop_conflict, x = population, y = event_id_c, style = "quantile", dim = 3)
# make sure to use Web/Pseudo Mercator (EPSG 3857)
st_crs(data)
gaza_hex_bis <- st_transform(data, 3857)
st_crs(data)
# For extent
ext <- st_transform(ext, crs = st_crs(3857))
ggplot() +
basemap_gglayer(ext) +
scale_fill_identity() +
coord_sf() +
geom_sf(data = data, mapping = aes(fill = bi_class), color = "#2a2b2a", size = 0.1, alpha = 0.7, show.legend = FALSE) +
bi_scale_fill(pal = "DkViolet2", dim = 3) +
labs(subtitle = "", caption = "Data source: POIs OpenStreetMap; OpenStreetMap building footprint, Sentinel-1 radar") +
bi_theme() +
theme(plot.caption = element_text(size = 7))  # Adjust the title size as needed
#coord_sf(xlim = c(34.20406, 34.57262), ylim = c(31.21163, 31.63442)) +
#coord_sf()
#scale_fill_identity()
st_crs(data)
gaza_hex_bis <- st_transform(data, 3857)
st_crs(data)
lebanon_bis <- st_transform(data, 3857)
st_crs(lebanon_bis)
ext <- st_transform(ext, crs = st_crs(3857))
ggplot() +
basemap_gglayer(ext) +
scale_fill_identity() +
coord_sf() +
geom_sf(data = lebanon_bis, mapping = aes(fill = bi_class), color = "#2a2b2a", size = 0.1, alpha = 0.7, show.legend = FALSE) +
bi_scale_fill(pal = "DkViolet2", dim = 3) +
labs(subtitle = "", caption = "Data source: POIs OpenStreetMap; OpenStreetMap building footprint, Sentinel-1 radar") +
bi_theme() +
theme(plot.caption = element_text(size = 7))  # Adjust the title size as needed
#coord_sf(xlim = c(34.20406, 34.57262), ylim = c(31.21163, 31.63442)) +
#coord_sf()
#scale_fill_identity()
# Create a map with Gaza administrative boundaries
map <- ggplot() +
#geom_sf(data = gaza_buil, fill = "transparent", color = "#a7aaab", size = 0.1) +
geom_sf(data = lebanon_bis, mapping = aes(fill = bi_class), color = "#2a2b2a", size = 0.1, alpha = 0.7, show.legend = FALSE) +  # Your data
bi_scale_fill(pal = "DkViolet2", dim = 3) +
#geom_sf(data = gaza_admin, fill = "transparent", color = "black", size = 0.2) +
labs(subtitle = "", caption = "Data source: POIs OpenStreetMap; OpenStreetMap building footprint, Sentinel-1 radar") +
bi_theme() +
theme(plot.caption = element_text(size = 7))  # Adjust the title size as needed
legend <- bi_legend(pal = "DkViolet2",
dim = 3,
xlab = "Damage",
ylab = "POIs",
size = 7)
# combine map with legend
finalPlot <- ggdraw() +
draw_plot(map, 0, 0, 1, 1) +
draw_plot(legend, 0.2, .65, 0.2, 0.2)
finalPlot
ggsave("maps/test_map_2.png", width = 8, height = 8, dpi = 400)
library(sf)
library(biscale)
library(dplyr)
library(ggplot2)
library(cowplot)
#library(basemapR)
library(basemaps)
#library(ggspatial)
#library(ggmap)
Lebanon_pop_density <- read_sf("../data_2024/pop_acled_lebanon.shp")
Lebanon_acled <- read_sf("../data_2024/acled_2023_2024_Lebanon.shp")
# Filter Lebanon_pop_density for population values above 500
Lebanon_pop_density_filtered <- Lebanon_pop_density[Lebanon_pop_density$population > 500, ]
# Set tmap mode to interactive
tmap_mode("view")
library(sf)
library(biscale)
library(dplyr)
library(ggplot2)
library(cowplot)
#library(basemapR)
library(tmap)
#library(ggspatial)
#library(ggmap)
Lebanon_pop_density <- read_sf("../data_2024/pop_acled_lebanon.shp")
Lebanon_acled <- read_sf("../data_2024/acled_2023_2024_Lebanon.shp")
# Filter Lebanon_pop_density for population values above 500
Lebanon_pop_density_filtered <- Lebanon_pop_density[Lebanon_pop_density$population > 500, ]
# Set tmap mode to interactive
tmap_mode("view")
# Plot the two datasets in interactive tmap
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("population", palette = "Blues", title = "Population Density (filtered)") +
tm_shape(Lebanon_acled) +
tm_dots(col = "red", size = 0.5, title = "ACLED Events") +
tm_layout(legend.outside = TRUE)
library(sf)
library(dplyr)
library(tmap)
Lebanon_pop_density <- read_sf("../data_2024/pop_acled_lebanon.shp")
Lebanon_acled <- read_sf("../data_2024/acled_2023_2024_Lebanon.shp")
# Filter Lebanon_pop_density for population values above 500
Lebanon_pop_density_filtered <- Lebanon_pop_density %>%
filter(population > 500) %>%
mutate(pop_category = case_when(
population >= 500 & population <= 5000 ~ "500 - 5,000",
population > 5000 & population <= 20000 ~ "5,001 - 20,000",
population > 20000 & population <= 40000 ~ "20,001 - 40,000"
))
# Set tmap mode to interactive
tmap_mode("view")
# Plot the two datasets in interactive tmap with categorized population and styled ACLED events
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category", palette = "Blues", title = "Population Density",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_symbols(shape = 23, col = "orange", border.col = "red", size = 0.1, title = "ACLED Events") +
tm_layout(legend.outside = TRUE)
library(sf)
library(dplyr)
library(tmap)
Lebanon_pop_density <- read_sf("../data_2024/pop_acled_lebanon.shp")
Lebanon_acled <- read_sf("../data_2024/acled_2023_2024_Lebanon.shp")
# Filter Lebanon_pop_density for population values above 500
Lebanon_pop_density_filtered <- Lebanon_pop_density %>%
filter(population > 500) %>%
mutate(pop_category = case_when(
population >= 500 & population <= 5000 ~ "500 - 5,000",
population > 5000 & population <= 20000 ~ "5,001 - 20,000",
population > 20000 & population <= 40000 ~ "20,001 - 40,000"
))
# Set tmap mode to interactive
tmap_mode("view")
# Plot the two datasets in interactive tmap with categorized population and styled ACLED events
# Plot the two datasets in interactive tmap with categorized population and styled ACLED events
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category", palette = "Blues", title = "Population Density",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_symbols(shape = 23, col = "orange", border.col = "red", size = 0.1, title = "ACLED Events", shape.legend = "Explosion") +
tm_layout(legend.outside = TRUE)
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category", palette = "Blues", title = "Population Density",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(shape = 23, col = "orange", border.col = "red", size = 0.1, title = "ACLED Events", shape.legend = "Explosion") +
tm_layout(legend.outside = TRUE)
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category", palette = "Blues", title = "Population Density",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_symbols(shape = 23, col = "orange")
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category", palette = "Blues", title = "Population Density",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange", border.col = "red", size = 0.1)
# Plot the two datasets in interactive tmap with categorized population and styled ACLED events
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category", palette = "Blues", title = "Population Density",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange", border.col = "red", size = 0.05, title = "ACLED Events") +
tm_layout(legend.outside = TRUE)
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category",
palette = "Blues",
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange",
border.col = "red",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
# Plot the two datasets in interactive tmap with categorized population and styled ACLED events
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category",
palette = "Blues",
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_symbols(col = "orange",
border.col = "red",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
# Plot the two datasets in interactive tmap with categorized population and styled ACLED events
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category",
palette = "Blues",
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange",
border.col = "red",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category",
palette = "Blues",
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange",
border.col = "red",
size = 0.05,
title = "ACLED Conflict Events",
legend.show = TRUE) +  # Ensure the legend for points is shown
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE,
legend.position = c("left", "bottom"))
```
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category",
palette = "Blues",
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange",
border.col = "red",
size = 0.05,
title = "ACLED Conflict Events",
legend.show = TRUE) +  # Ensure the legend for points is shown
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE) +
tm_view(view.legend.position = c("left", "bottom"))
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category",
palette = "YlOrBr",
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange",
border.col = "red",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
tm_shape(Lebanon_pop_density_filtered) +
tm_basemap("CartoDB.PositronNoLabels") +
tm_polygons("pop_category",
palette = "Blues",
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange",
border.col = "red",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
View(Lebanon_acled)
# Define a custom blue palette starting with a darker blue
custom_blue_palette <- c("#468FAF", "#1E6091", "#0D3B66")  # Gradient from dark to light blue
# Set tmap mode to interactive
tmap_mode("view")
# Plot the datasets with custom blue palette, basemap, and improved legends
tm_shape(Lebanon_pop_density_filtered) +
tm_basemap("CartoDB.PositronNoLabels") +
tm_polygons("pop_category",
palette = custom_blue_palette,
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "yellow",
border.col = "darkred",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE) +
tm_view(view.legend.position = c("left", "bottom"))
# Define a custom blue palette starting with a darker blue
custom_blue_palette <- c("#468FAFCC", "#1E6091CC", "#0D3B66CC")  # Gradient from dark to light blue
# Set tmap mode to interactive
tmap_mode("view")
# Plot the datasets with custom blue palette, basemap, and improved legends
tm_shape(Lebanon_pop_density_filtered) +
tm_basemap("CartoDB.PositronNoLabels") +
tm_polygons("pop_category",
palette = custom_blue_palette,
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "yellow",
border.col = "darkred",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
# Define a custom blue palette starting with a darker blue
custom_blue_palette <- c("#0D3B66AA", "#1E6091AA", "#468FAFAA")  # Gradient from dark to light blue
# Set tmap mode to interactive
tmap_mode("view")
# Plot the datasets with custom blue palette, basemap, and improved legends
tm_shape(Lebanon_pop_density_filtered) +
tm_basemap("CartoDB.PositronNoLabels") +
tm_polygons("pop_category",
palette = custom_blue_palette,
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "yellow",
border.col = "darkred",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
# Plot the datasets with improved legends and labels
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category",
palette = "Blues",
title = "Population Density (people per 1 km²)",
labels = c("500 - 5,000", "5,001 - 20,000", "20,001 - 40,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange",
border.col = "red",
size = 0.05,
title = "ACLED Conflict Events",
legend.show = TRUE) +  # Ensure the legend for points is shown
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE) +
tm_view(view.legend.position = c("left", "bottom"))
tm_shape(Lebanon_pop_density_filtered) +
tm_polygons("pop_category",
palette = "Blues",
title = "Population Density (people per 1 km²)",
labels = c("20,001 - 40,000", "5,001 - 20,000", "500 - 5,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "orange",
border.col = "red",
size = 0.05,
title = "ACLED Conflict Events",
legend.show = TRUE) +  # Ensure the legend for points is shown
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE) +
tm_view(view.legend.position = c("left", "bottom"))
tm_shape(Lebanon_pop_density_filtered) +
tm_basemap("CartoDB.PositronNoLabels") +
tm_polygons("pop_category",
palette = custom_blue_palette,
title = "Population Density (people per 1 km²)",
labels = c("20,001 - 40,000", "5,001 - 20,000", "500 - 5,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "yellow",
border.col = "darkred",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
# Define a custom blue palette starting with a darker blue
custom_blue_palette <- c("#0B2C49CC", "#1E6091AA", "#468FAFAA")  # Gradient from dark to light blue
# Set tmap mode to interactive
tmap_mode("view")
# Plot the datasets with custom blue palette, basemap, and improved legends
tm_shape(Lebanon_pop_density_filtered) +
tm_basemap("CartoDB.PositronNoLabels") +
tm_polygons("pop_category",
palette = custom_blue_palette,
title = "Population Density (people per 1 km²)",
labels = c("20,001 - 40,000", "5,001 - 20,000", "500 - 5,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "yellow",
border.col = "darkred",
size = 0.05,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
# Plot the datasets with custom blue palette, basemap, and improved legends
tm_shape(Lebanon_pop_density_filtered) +
tm_basemap("CartoDB.PositronNoLabels") +
tm_polygons("pop_category",
palette = custom_blue_palette,
title = "Population Density (people per 1 km²)",
labels = c("20,001 - 40,000", "5,001 - 20,000", "500 - 5,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "yellow",
border.col = "darkred",
size = 0.005,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
# Define a custom blue palette starting with a darker blue
custom_blue_palette <- c("#0B2C49CC", "#1E6091AA", "#A9D6E5CC")  # Gradient from dark to light blue
# Set tmap mode to interactive
tmap_mode("view")
# Plot the datasets with custom blue palette, basemap, and improved legends
tm_shape(Lebanon_pop_density_filtered) +
tm_basemap("CartoDB.PositronNoLabels") +
tm_polygons("pop_category",
palette = custom_blue_palette,
title = "Population Density (people per 1 km²)",
labels = c("20,001 - 40,000", "5,001 - 20,000", "500 - 5,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "yellow",
border.col = "darkred",
size = 0.005,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
# Define a custom blue palette starting with a darker blue
custom_blue_palette <- c("#0B2C49CC", "#1E6091AA", "#A9D6E5CC")  # Gradient from dark to light blue
# Set tmap mode to interactive
tmap_mode("view")
# Plot the datasets with custom blue palette, basemap, and improved legends
tm_shape(Lebanon_pop_density_filtered) +
tm_basemap("CartoDB.PositronNoLabels") +
tm_polygons("pop_category",
palette = custom_blue_palette,
title = "Population Density (people per 1 km²)",
labels = c("20,001 - 40,000", "5,001 - 20,000", "500 - 5,000")) +
tm_shape(Lebanon_acled) +
tm_dots(col = "yellow",
border.col = "darkred",
size = 0.010,
title = "ACLED Conflict Events") +
tm_layout(legend.outside = TRUE,
legend.title.size = 1.2,
legend.text.size = 0.8,
legend.bg.color = "white",
legend.frame = TRUE)
